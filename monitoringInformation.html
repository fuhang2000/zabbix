<!DOCTYPE html>
<html lang="zh">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-transform">
    <title>监测信息</title>
    <link rel="stylesheet" href="css/monitoringInformation.css">
    <script src="js/zepto.min.js"></script>
    <script src="js/all.js"></script>
    <script src="js/canvas-data-loading.js"></script>
</head>
<body>



    <div class="header">
        <a href="javascript:history.back(-1)"><img class="img1" src="img/nav_icon_back_normal.png"></a>
        <span>监测信息</span>
        <a href="setting.html"><img class="img2" src="img/nav_icon_set_normal.png"></a>
    </div>


    <div class="mycontainer">
        <div class="mycontainer-contai">
            <div class="mycontainer-top">
                <div class="mycontainer-top-top">
                    <span>流量数据</span>
                    <img src="img/con_btn_data_normal.png">
                </div>
                <div class="mycontainer-top-left">
                    <div class="text">
                        <span>最高高达&nbsp99%</span>
                    </div>
                    <div class="canvas">
                        <canvas id="myCanvas1">你的浏览器版本过低，暂不支持canvas</canvas>
                    </div>
                </div>
                <div class="mycontainer-top-right">
                    <div class="text">
                        <span>最高高达&nbsp71%</span>
                    </div>
                    <div class="canvas">
                        <canvas id="myCanvas2">你的浏览器版本过低，暂不支持canvas</canvas>
                    </div>
                </div>
            </div>
            <div class="mycontainer-content">
                <ul>
                    <li class="mycontainer-specific">
                        <span class="text-left">最大响应时间</span>
                        <span class="text-right">56S</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left">当前响应时间</span>
                        <span class="text-right">6S</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left">最大当日掉包率</span>
                        <span class="text-right">27%</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left">当前当日掉包率</span>
                        <span class="text-right">12%</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left" >当前接收速率</span>
                        <span class="text-right" id="invalue">12%</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left">当前发送速率</span>
                        <span class="text-right"id="outvalue">12%</span>
                    </li>
                    <li class="mycontainer-specific">
                        <span class="text-left">IP</span>
                        <span class="text">127.0.0.1</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="footer"><!--底部 固定  开始-->
        <div class="footer-container div">
            <div class="switchboard">
                <a href="index.html" ><img src="img/tab_icon_switch.png">
                    <span>交换机</span></a>
            </div>
            <div class="WIFI div">
                <a href="wifi.html" >
                    <img src="img/tab_icon_wifi.png">
                    <span>WIFI</span>
                </a>
            </div>
            <div class="terminal div">
                <a href="terminal.html" >
                    <img src="img/tab_icon_pc.png">
                    <span>终端</span>
                </a>
            </div>
            <div class="alarm-information div">
                <a href="alarmInformation.html">
                    <img src="img/tab_icon_news.png">
                    <span>告警信息</span>
                </a>
            </div>
        </div>
    </div><!--底部   结束-->


    <script>
				            
				            var Hostcpuvalue;
				          //空闲内存
							var availableMemory ;
							//总内存
							var totalMemory ;
							//内存使用率百分比
					       var  Memoryrate;
					       //CPU使用率
					       var  CPUrate;
       var Entity = {
    name:1,//主机名
    id: 1,//id
    invalue:1,//上行
    outvalue:1,//下行
    auth:1
};
var JsonStr =localStorage.getItem("json");
alert(JsonStr)
 Entity = JSON.parse(JsonStr);


$(function () {
		
				            var flag;
//---------------------------------------------查询内存使用率start----------------------------------------------------------------------				
				
				var getMemoryinfo = {
					"jsonrpc": "2.0",
					"method": "item.get",
					"params": {
						"output": "extend",
						"hostids": Entity.id,
						"search": {
							"key_": "memory"
						},
						"sortfield": "name"
					},
					"auth": Entity.auth,
					"id": 1
				}
				$.ajax({

					type: "post",
					async: false,
					contentType: "application/json;charset=utf-8",

					url: "http://123.207.235.243/api_jsonrpc.php",

					data: JSON.stringify(getMemoryinfo),

					dataType: "json",

					success: function(result) {

						if(result != null) {
							//查询内存  返回数组集合   下标1位当前空闲内存   2    总内存
							
							//空闲内存
							 availableMemory = result.result[0].lastvalue;
							//总内存
							 totalMemory = result.result[1].lastvalue;
							//使用率百分比
					        Memoryrate= (1-(availableMemory/totalMemory));
					     
					      //   保留一位小数
					     Memoryrate=(Memoryrate*100).toFixed(1);
							
							alert("内存比例:  "+Memoryrate)
							flag = true;
						} else {
							HsotMemoryvalue = "--";
							flag = false;
						}

					}

				});

				if(flag) {
$("#invalue").text(Entity.invalue);
$("#outvalue").text(Entity.outvalue);

				
				} else {
					alert("返回值错误");
					return invalue;
				}
//---------------------------------------------查询内存使用率END----------------------------------------------------------------------				
				
				
//---------------------------------------------查询CPU使用率start----------------------------------------------------------------------
				var getCPUinfo = {
					"jsonrpc": "2.0",
					"method": "item.get",
					"params": {
						"output": "extend",
						"hostids": Entity.id,
						"search": {
							"key_": "system.cpu.util[,idle]"
						},
						"sortfield": "name"
					},
					"auth": Entity.auth,
					"id": 1
				}
				$.ajax({

					type: "post",
					async: false,
					contentType: "application/json;charset=utf-8",

					url: "http://123.207.235.243/api_jsonrpc.php",

					data: JSON.stringify(getCPUinfo),

					dataType: "json",

					success: function(result) {

						if(result != null) {
							//查询CPU  
							alert(result.result[0].lastvalue)
							
							CPUrate=100-result.result[0].lastvalue;

					      //   保留一位小数
					     CPUrate=CPUrate.toFixed(1);
							
						//	alert("CPU使用率:  "+CPUrate)
							flag = true;
						} else {
							HsotMemoryvalue = "--";
							flag = false;
						}

					}

				});

//---------------------------------------------获取CPU使用率end----------------------------------------------------------------------
	
        /*canvas画图开始*/
        let obj1 = new LoadingCanvas({
            dom: "#myCanvas1",
            innerRound: 75 ,
            highestColor: "#FEA81A",
            currentColor: "#4cfd64",
            tipsWord: {
                content: "CPU"
            },
            
           value :{
                "current": CPUrate,
                 "highest": 80
                       }
            /*grads: {
             ratio: 0.8
             },
             gaps: {
             length: [2, 2]
             },
            url: "json/test.json"*/
        });
        console.log(obj1);
        let obj2 = new LoadingCanvas({
            dom: "#myCanvas2",
            innerRound: 75,
            tipsWord: {
                content: "内存"
            },
            
          value :{
  "current": Memoryrate,
  "highest": 80
}
/* 
            grads: {
             ratio: 0.8
             },
             gaps: {
             length: [2, 2]
             },
            
            url: "json/test.json"*/
        });
        console.log(obj2);
})


    
        /*底部导航*/
        $(function () {
            $(".footer-container div").eq(0).css({
                background:"#1e69d2"
            });
            $(".footer-container div").click(function () {
                $(".footer-container div").css({
                    background: "#1d5cb6"
                });
                $(this).css({
                    background:"#1e69d2"
                });
            });
        });


    </script>
</body>
</html>